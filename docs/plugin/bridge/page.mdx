---
title: ìœˆë„ìš° ê°„ í†µì‹ 
description: Bridge APIë¥¼ ì‚¬ìš©í•œ ë©”ì¸-ì˜¤ë²„ë ˆì´ ê°„ í†µì‹ 
---

# ìœˆë„ìš° ê°„ í†µì‹  (Bridge)

`dmn.bridge`ë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ì¸ ìœˆë„ìš°ì™€ ì˜¤ë²„ë ˆì´ ìœˆë„ìš° ê°„ì— ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ìš©ë„

- ğŸªŸ **ìœˆë„ìš° ê°„ í†µì‹ **: ë©”ì¸ â†” ì˜¤ë²„ë ˆì´ ê°„ ë°ì´í„° ì „ì†¡
- ğŸ”Œ **í”ŒëŸ¬ê·¸ì¸ ê°„ í†µì‹ **: ê°™ì€ ë˜ëŠ” ë‹¤ë¥¸ ìœˆë„ìš°ì˜ í”ŒëŸ¬ê·¸ì¸ë¼ë¦¬ ë°ì´í„° ê³µìœ 
- ğŸ“¡ **ë¸Œë¡œë“œìºìŠ¤íŠ¸**: ëª¨ë“  ìœˆë„ìš°ì˜ ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡

## API ë ˆí¼ëŸ°ìŠ¤

### send(type, data)

ëª¨ë“  ìœˆë„ìš°ì— ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.

```javascript
await dmn.bridge.send("WPM_UPDATE", { value: 80, max: 200 });
```

### sendTo(target, type, data)

íŠ¹ì • ìœˆë„ìš°ì—ë§Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

```javascript
// ì˜¤ë²„ë ˆì´ì—ë§Œ ì „ì†¡
await dmn.bridge.sendTo("overlay", "THEME_CHANGED", { theme: "dark" });

// ë©”ì¸ì—ë§Œ ì „ì†¡
await dmn.bridge.sendTo("main", "KEY_PRESSED", { key: "KeyD" });
```

### on(type, listener)

íŠ¹ì • íƒ€ì…ì˜ ë©”ì‹œì§€ë¥¼ êµ¬ë…í•©ë‹ˆë‹¤.

```javascript
const unsub = dmn.bridge.on("WPM_UPDATE", (data) => {
  console.log("WPM:", data.value);
});

// êµ¬ë… í•´ì œ
unsub();
```

### once(type, listener)

íŠ¹ì • íƒ€ì…ì˜ ë©”ì‹œì§€ë¥¼ 1íšŒë§Œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

```javascript
dmn.bridge.once("INIT_COMPLETE", (data) => {
  console.log("ì´ˆê¸°í™” ì™„ë£Œ:", data);
});
```

### onAny(listener)

ëª¨ë“  íƒ€ì…ì˜ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ë””ë²„ê¹…ì— ìœ ìš©í•©ë‹ˆë‹¤.

```javascript
const unsub = dmn.bridge.onAny((type, data) => {
  console.log(`[Bridge] ${type}:`, data);
});
```

### off(type, listener?)

ë©”ì‹œì§€ êµ¬ë…ì„ í•´ì œí•©ë‹ˆë‹¤.

```javascript
// íŠ¹ì • ë¦¬ìŠ¤ë„ˆ í•´ì œ
dmn.bridge.off("WPM_UPDATE", myListener);

// í•´ë‹¹ íƒ€ì…ì˜ ëª¨ë“  ë¦¬ìŠ¤ë„ˆ í•´ì œ
dmn.bridge.off("WPM_UPDATE");
```

## ì‚¬ìš© íŒ¨í„´

### ë‹¨ë°©í–¥ ì´ë²¤íŠ¸ ì „ì†¡

```javascript
// ì˜¤ë²„ë ˆì´ì—ì„œ ì „ì†¡
await dmn.bridge.send("KEY_PRESSED", { key: "KeyD" });

// ë©”ì¸ì—ì„œ ìˆ˜ì‹ 
dmn.bridge.on("KEY_PRESSED", ({ key }) => {
  console.log(`${key} pressed`);
});
```

### ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”

```javascript
// === ì˜¤ë²„ë ˆì´: KPS ê³„ì‚° í›„ ì „ì†¡ ===
// @id kps-sender

if (dmn.window.type !== "overlay") return;

let count = 0;

dmn.keys.onKeyState(({ state }) => {
  if (state === "DOWN") count++;
});

setInterval(() => {
  dmn.bridge.sendTo("main", "KPS_UPDATE", { kps: count });
  count = 0;
}, 100);
```

```javascript
// === ë©”ì¸: KPS í‘œì‹œ ===
// @id kps-display

if (dmn.window.type !== "main") return;

const display = document.createElement("div");
display.textContent = "KPS: 0";
document.body.appendChild(display);

dmn.bridge.on("KPS_UPDATE", ({ kps }) => {
  display.textContent = `KPS: ${kps}`;
});

dmn.plugin.registerCleanup(() => {
  display.remove();
});
```

### ìš”ì²­-ì‘ë‹µ íŒ¨í„´

```javascript
// === ë©”ì¸: ë°ì´í„° ìš”ì²­ ===
dmn.bridge.send("REQUEST_STATS", { type: "current" });

dmn.bridge.once("RESPONSE_STATS", (stats) => {
  console.log("í†µê³„:", stats);
});
```

```javascript
// === ì˜¤ë²„ë ˆì´: ìš”ì²­ ì²˜ë¦¬ ë° ì‘ë‹µ ===
dmn.bridge.on("REQUEST_STATS", ({ type }) => {
  const stats = {
    kps: currentKPS,
    totalKeys: totalKeyCount,
    uptime: Date.now() - startTime,
  };

  dmn.bridge.sendTo("main", "RESPONSE_STATS", stats);
});
```

### í”ŒëŸ¬ê·¸ì¸ ê°„ ë°ì´í„° ê³µìœ 

```javascript
// === ë°ì´í„° ì œê³µì (data-provider.js) ===
// @id data-provider

const sharedData = { score: 0, level: 1 };

function updateData(score, level) {
  sharedData.score = score;
  sharedData.level = level;
  dmn.bridge.send("SHARED_DATA_UPDATE", sharedData);
}

// ì˜ˆì‹œ: 1ì´ˆë§ˆë‹¤ ì ìˆ˜ ì¦ê°€
setInterval(() => {
  updateData(sharedData.score + 10, sharedData.level);
}, 1000);
```

```javascript
// === ë°ì´í„° ì†Œë¹„ì A (consumer-a.js) ===
// @id consumer-a

dmn.bridge.on("SHARED_DATA_UPDATE", (data) => {
  console.log("[Consumer A] ë°ì´í„°:", data);
  updateUI(data.score);
});
```

```javascript
// === ë°ì´í„° ì†Œë¹„ì B (consumer-b.js) ===
// @id consumer-b

// ê°™ì€ ë©”ì‹œì§€ë¥¼ ì—¬ëŸ¬ í”ŒëŸ¬ê·¸ì¸ì´ ë™ì‹œì— ë°›ì„ ìˆ˜ ìˆìŒ
dmn.bridge.on("SHARED_DATA_UPDATE", (data) => {
  console.log("[Consumer B] ë°ì´í„°:", data);
  displayLevel(data.level);
});
```

## Display Elementì™€ Bridge ì—°ë™

```javascript
// @id bridge-panel

if (dmn.window.type !== "main") return;

const panel = dmn.ui.displayElement.add({
  position: { x: 100, y: 100 },
  state: { kps: 0, history: [] },
  template: (state, { html }) => html`
    <div
      style="
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 16px;
      border-radius: 8px;
    "
    >
      <div style="font-size: 24px; font-weight: bold;">${state.kps} KPS</div>
      <div
        style="display: flex; gap: 2px; height: 30px; align-items: flex-end;"
      >
        ${state.history.map(
          (v) => html`
            <div
              style="
            flex: 1;
            height: ${v}%;
            background: #86EFAC;
            border-radius: 2px;
          "
            ></div>
          `
        )}
      </div>
    </div>
  `,
});

const unsub = dmn.bridge.on("KPS_UPDATE", ({ kps, max }) => {
  const snapshot = panel.getState();
  const history = [...snapshot.history, max ? (kps / max) * 100 : 0].slice(-20);
  panel.setState({ kps, history });
});

dmn.plugin.registerCleanup(() => {
  unsub();
  panel.remove();
});
```

## ë©”ì‹œì§€ íƒ€ì… ë„¤ì´ë° ê¶Œì¥ì‚¬í•­

ì¼ê´€ì„± ìˆëŠ” ë©”ì‹œì§€ íƒ€ì… ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”:

```javascript
// ì¢‹ì€ ì˜ˆ: SCREAMING_SNAKE_CASE
"KPS_UPDATE";
"RECORDING_START";
"RECORDING_STOP";
"SETTINGS_CHANGED";
"PANEL_CREATED";

// ë‚˜ìœ ì˜ˆ
"kpsUpdate";
"recording-start";
"SettingsChanged";
```

## ì£¼ì˜ì‚¬í•­

- Bridge ë©”ì‹œì§€ëŠ” **ì§ë ¬í™” ê°€ëŠ¥í•œ ë°ì´í„°**ë§Œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í•¨ìˆ˜, DOM ìš”ì†Œ, ìˆœí™˜ ì°¸ì¡°ê°€ ìˆëŠ” ê°ì²´ëŠ” ì „ì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡ì€ ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•˜ì„¸ìš”.
- êµ¬ë…ì€ ë°˜ë“œì‹œ í´ë¦°ì—… ì‹œ í•´ì œí•˜ì„¸ìš”.

```javascript
dmn.plugin.registerCleanup(() => {
  // êµ¬ë… í•´ì œ
  unsub1();
  unsub2();
});
```
